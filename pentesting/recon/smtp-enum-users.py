#!/usr/bin/python

import sys
import socket

if len(sys.argv) != 3:
	print "Usage: ./smtp-enum-users.py ip usernames-file-path"
	sys.exit(0)

ip= sys.argv[1]
s= socket.socket(socket.AF_INET, socket.SOCK_STREAM)
try:
	connect= s.connect((ip,25))
except:
	print "can't connect, quitting"
	exit(0)

banner=s.recv(1024)
with open(sys.argv[2], 'rU') as in_file:
    names = in_file.read().split('\n') 
print banner
print 'Trying to validate existance of these names' + str(names)
for n in names:
	s.send('HELO')
	s.recv(1024)
	s.send('VRFY ' + n + '\r\n')
	result= s.recv(1024)
	print result
s.close()
